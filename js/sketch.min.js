function submitform(){document.form1.hid1.value=postURL,document.form1.submit()}function preload(){soundFile=loadSound("music.mp3"),overlayimg=loadImage("overlay.png")}function setup(){canvas2=createCanvas(myWidth,myHeight),canvas2.parent("canvasContainer"),filter=new p5.LowPass,soundFile.disconnect(),soundFile.connect(filter),backgroundColor=color(0,0,0,220),amplitude=new p5.Amplitude,videoInput=createCapture(VIDEO),document.getElementById("allowText").style.visibility="visible",document.getElementById("arrowText").style.visibility="visible",videoInput.parent("canvasContainer"),videoInput.size(myWidth,myHeight),videoInput.hide(),ctracker=new clm.tracker,ctracker.init(pModel),ctracker.start(videoInput.elt)}function draw(){level=3*amplitude.getLevel(),detectBeat(level);var e,t=soundFile.currentTime(),i=soundFile.duration();e=0===t?color(100):color(random(120,155),random(60,80),random(210,255),400*level),document.getElementById("backPanel").style.background=e.colorString,clear(),blendMode(BLEND),soundFile.isLoaded()&&(imageMode(CORNER),image(videoInput,0,0,myWidth,myHeight),noStroke(),fill(backgroundColor),rect(0,0,myWidth,myHeight)),strokeWeight(.5);var l=ctracker.getCurrentPosition();if(l){document.getElementById("allowText").style.display="none",document.getElementById("arrowText").style.display="none",document.getElementById("bottomPanel").style.visibility="visible",document.getElementById("howClick").style.visibility="visible",document.getElementById("snapClick").style.visibility="visible";var a=map(l[62][1],0,200,1.5,0);soundFile.setVolume(a>0?a:a>1?1:0);var n=map(l[62][1],0,200,50,0);document.getElementById("volumeBar").setAttribute("x2",n);var o=l[57][1]-l[60][1],r=map(o,-35,35,0,50);document.getElementById("slowBar").setAttribute("x2",r),soundFile.rate(o>19&&20>o?map(o,19,20,1,.9):o>20?.9:1);var m=map(o,-15,35,170,270);noStroke(),soundFile.isPlaying()?fill(random(o/4),0,o/4,m):fill(10,0,20,180),rect(0,0,myWidth,myHeight);var d=map(l[62][0],100,300,-1,1);soundFile.pan(d>1?1:-1>d?-1:d);var s=map(d,-1,1,50,0);document.getElementById("panBar").setAttribute("x2",s);var v=myWidth/2-l[62][0];noFill(),-50>v?(stroke(random(255),50,255,10*level*map(v,-50,-200,0,255)),strokeWeight(1),line(l[1][0],l[1][1],0,l[1][1]),strokeWeight(.2),ellipse(l[1][0],l[1][1],55*level,55*level)):v>50&&(strokeWeight(1),stroke(random(255),50,255,10*level*map(v,50,200,0,255)),line(l[13][0],l[13][1],myWidth,l[13][1]),strokeWeight(.2),ellipse(l[13][0],l[13][1],55*level,55*level)),t>94.5&&126>t&&(strokeWeight(1),stroke(random(255),50,255,200*level+10),randomOnBeat%2===0?(line(l[0][0],l[0][1],0,l[0][1]),line(l[14][0],l[14][1],myWidth,l[14][1])):randomOnBeat%2===1&&(line(l[7][0],l[7][1],l[7][0],myHeight),line(l[33][0],l[33][1],l[33][0],0))),l[32][1]-l[27][1]>2?(filterFreq=map(l[32][1]-l[27][1],30,0,3e3,22050),filterRes=map(l[32][1]-l[27][1],30,0,15,5),filter.set(filterFreq,filterRes)):l[32][1]-l[27][1]<-2?(filterFreq=map(l[32][1]-l[27][1],-30,0,3e3,22050),filterRes=map(l[32][1]-l[27][1],-30,0,5,15),filter.set(filterFreq,filterRes)):filter.set(map(o,25,0,0,22050,map(o,25,0,5,80)));var y=map(l[32][1]-l[27][1],-30,30,50,0);document.getElementById("filterBar").setAttribute("x2",y),noFill(),strokeWeight(.5),stroke(255,255,255,0),beginShape(),vertex(l[23][0],l[23][1]),endShape(CLOSE),stroke(255,255,255,50),beginShape(),vertex(l[28][0],l[28][1]),vertex(l[67][0],l[67][1]),vertex(l[29][0],l[29][1]),vertex(l[68][0],l[68][1]),vertex(l[30][0],l[30][1]),vertex(l[69][0],l[69][1]),vertex(l[31][0],l[31][1]),vertex(l[70][0],l[70][1]),endShape(CLOSE),beginShape(),vertex(l[23][0],l[23][1]),vertex(l[63][0],l[63][1]),vertex(l[24][0],l[24][1]),vertex(l[64][0],l[64][1]),vertex(l[25][0],l[25][1]),vertex(l[65][0],l[65][1]),vertex(l[26][0],l[26][1]),vertex(l[66][0],l[66][1]),endShape(CLOSE),noFill(),stroke(255,random(255),255,random(100)),ellipse(l[27][0],l[27][1],80*level,80*level),ellipse(l[32][0],l[32][1],80*level,80*level),stroke(255,random(255),random(255),random(50)),ellipse(l[27][0],l[27][1],150*level,150*level),ellipse(l[32][0],l[32][1],150*level,150*level),stroke(255,random(255),255,random(30)),ellipse(l[27][0],l[27][1],200*level,200*level),ellipse(l[32][0],l[32][1],200*level,200*level),stroke(255,random(255),255,random(40,60)),line(l[15][0],l[15][1],l[16][0],l[16][1]),line(l[16][0],l[16][1],l[17][0],l[17][1]),line(l[17][0],l[17][1],l[18][0],l[18][1]),line(l[19][0],l[19][1],l[20][0],l[20][1]),line(l[20][0],l[20][1],l[21][0],l[21][1]),line(l[21][0],l[21][1],l[22][0],l[22][1]),strokeWeight(1),stroke(random(255),random(255),255,map(300*level,0,100,random(35,55),180)),line(l[33][0],l[33][1],l[41][0],l[41][1]),line(l[41][0],l[41][1],l[62][0],l[62][1]),beginShape(),vertex(l[42][0],l[42][1]),vertex(l[37][0],l[37][1]),vertex(l[43][0],l[43][1]),endShape(OPEN),t>82.8&&(stroke(random(255),random(255),255,map(300*level,0,100,25,180)),beginShape(),vertex(l[34][0],l[34][1]),vertex(l[35][0],l[35][1]),vertex(l[36][0],l[36][1]),vertex(l[42][0],l[42][1]),vertex(l[37][0],l[37][1]),vertex(l[43][0],l[43][1]),vertex(l[38][0],l[38][1]),vertex(l[39][0],l[39][1]),vertex(l[40][0],l[40][1]),endShape(OPEN));for(var g=0;g<l.length;g++){fill(map(l[g][0],.33*myWidth,.66*myWidth,0,255),map(l[g][1],.33*myHeight,.66*myHeight,0,255),255,100),noStroke(),ellipse(l[g][0],l[g][1],5*level,5*level),ellipse(l[g][0],l[g][1],map(o,-5,35,.2,-1),map(o,-5,35,.2,-1)),ellipse(l[27][0],l[27][1],5,5),ellipse(l[32][0],l[32][1],5,5),fill(255,255,255,random(150,255)),ellipse(l[27][0],l[27][1],4,4),ellipse(l[32][0],l[32][1],4,4),stroke(random(150),50,250,constrain(100*level,5,45)),line(l[g][0],l[g][1],l[32][0],l[32][1]),line(l[g][0],l[g][1],l[27][0],l[27][1]),g>=15&&23>=g&&(stroke(map(l[g][0],.33*myWidth,.66*myWidth,0,255),map(l[g][1],.33*myHeight,.66*myHeight,0,255),255,40+200*level),line(l[g][0],l[g][1],l[g][0],l[g][1]-level*random(50,100)));var c=map(l[32][1]-l[27][1],-30,30,-100,100);fill(map(l[g][0],.33*myWidth,.66*myWidth,0,255),map(l[g][1],.33*myHeight,.66*myHeight,0,255),255,100),-15>c?(noStroke(),ellipse(l[g][0],l[g][1],map(c,0,-100,-1,1),map(c,0,-100,-2,.2)),g>=0&&6>=g?(stroke(random(255),50,250,6*level*map(c,0,-100,-15,45)),line(l[g][0],l[g][1],0,l[g][1])):(stroke(random(255),50,250,3*level*map(c,0,-100,-15,15)),line(l[g][0],l[g][1],0,l[g][1]))):c>15&&(noStroke(),ellipse(l[g][0],l[g][1],map(c,0,100,-1,1),map(c,0,100,-2,.2)),g>=8&&14>=g?(stroke(random(255),50,250,6*level*map(c,0,100,-15,45)),line(l[g][0],l[g][1],myWidth,l[g][1])):(stroke(random(255),50,250,3*level*map(c,0,100,-15,15)),line(l[g][0],l[g][1],myWidth,l[g][1]))),strokeWeight(1),stroke(random(250),50,150,map(300*level,0,100,25,150)),(42===g||43===g||22===g||18===g)&&(line(l[g][0],l[g][1],l[41][0],l[41][1]),line(l[g][0],l[g][1],l[33][0],l[33][1]),line(l[g][0],l[g][1],l[62][0],l[62][1])),37===g&&line(l[g][0],l[g][1],l[62][0],l[62][1]),(t>47.3&&63>t||t>86.5)&&(stroke(255,random(255),255,map(300*level,0,100,20,40)),(51===g||52===g||53===g||58===g)&&(line(l[g][0],l[g][1],l[50][0],l[50][1]),line(l[g][0],l[g][1],l[57][0],l[57][1])),(53===g||54===g||55===g||56===g)&&(line(l[g][0],l[g][1],l[44][0],l[44][1]),line(l[g][0],l[g][1],l[57][0],l[57][1])),(45===g||46===g||47===g||61===g)&&(line(l[g][0],l[g][1],l[60][0],l[60][1]),line(l[g][0],l[g][1],l[44][0],l[44][1])),(47===g||48===g||49===g||59===g)&&(line(l[g][0],l[g][1],l[60][0],l[60][1]),line(l[g][0],l[g][1],l[50][0],l[50][1]))),strokeWeight(.5),stroke(map(l[g][0],.33*myWidth,.66*myWidth,0,255),map(l[g][1],.33*myHeight,.66*myHeight,0,255),255,3),noFill(),ellipse(l[27][0],l[27][1],13-5*level,13-5*level),ellipse(l[32][0],l[32][1],13-5*level,13-5*level),ellipse(l[27][0],l[27][1],100*level,100*level),ellipse(l[32][0],l[32][1],100*level,100*level),strokeWeight(1),stroke(map(l[g][0],.33*myWidth,.66*myWidth,0,255),map(l[g][1],.33*myHeight,.66*myHeight,0,255),255,2);var p=random(20);ellipse(l[27][0],l[27][1],100*level+p,100*level+p),ellipse(l[32][0],l[32][1],100*level+p,100*level+p),noFill(),stroke(map(l[g][0],.33*myWidth,.66*myWidth,0,155),map(l[g][1],.33*myHeight,.66*myHeight,0,155),155,3),beginShape(),vertex(l[59][0],l[59][1]),vertex(l[60][0],l[60][1]),vertex(l[61][0],l[61][1]),vertex(l[44][0],l[44][1]),vertex(l[56][0],l[56][1]),vertex(l[57][0],l[57][1]),vertex(l[58][0],l[58][1]),vertex(l[50][0],l[50][1]),endShape(CLOSE),t>=63&&78.8>=t&&(stroke(random(150),50,250,map(100*level,0,100,-10,80)),line(l[g][0],l[g][1],0,l[g][1]),line(l[g][0],l[g][1],myWidth,l[g][1])),(t>173.73&&204>t||t>268.2&&300>t)&&(stroke(random(150),50,250,map(100*level,0,100,-20,60)),line(l[g][0],l[g][1],0,random(myHeight)),line(l[g][0],l[g][1],myWidth,random(myHeight))),t>.1&&.5>t&&$("#rectCont").slideUp("fast"),t>3.8&&4>t&&$("#instruction").show("fast"),t>29.8&&30>t&&$("#instruction").hide("fast")}if(t>.1){imageMode(CENTER),blendMode(OVERLAY),soundFile.isPlaying()||(image(overlayimg,l[27][0],l[27][1],overlayimg.width,overlayimg.height),image(overlayimg,l[32][0],l[32][1],overlayimg.width,overlayimg.height));var u=l[62][0],h=l[62][1];if(image(overlayimg,u,h,3*overlayimg.width,3*overlayimg.height),t>31.5&&47.3>t&&(image(overlayimg,l[33][0],l[33][1],2*overlayimg.width,2*overlayimg.height),image(overlayimg,l[33][0],l[33][1],overlayimg.width,overlayimg.height)),t>55&&78.8>t){tint(180,random(255),255,map(200*level,20,30,0,255));var b=lerp(l[60][1],l[57][1],.5),f=lerp(l[60][0],l[57][0],.5);image(overlayimg,f,b,overlayimg.width,overlayimg.height)}t>78.8&&(image(overlayimg,l[33][0],l[33][1],2*overlayimg.width,2*overlayimg.height),image(overlayimg,l[27][0],l[27][1],overlayimg.width/3,overlayimg.height/3),image(overlayimg,l[32][0],l[32][1],overlayimg.width/3,overlayimg.height/3),tint(255,map(200*level,20,50,0,70)),image(overlayimg,u,h,overlayimg.width/3,overlayimg.height/3),image(overlayimg,l[27][0],l[27][1],overlayimg.width/2,overlayimg.height/2),image(overlayimg,l[32][0],l[32][1],overlayimg.width/2,overlayimg.height/2)),(t>94.5&&126.5>t||t>173.73&&204>t||t>268.2&&300>t)&&(tint(255,map(200*level,20,50,35,60)),image(overlayimg,myWidth/2,myHeight/2,4*overlayimg.width,4*overlayimg.height)),(t>126.5&&157>t||t>220&&236>t)&&(tint(50,random(150,255),random(190,255),250),image(overlayimg,u,h,2*overlayimg.width,2*overlayimg.height))}if(soundFile.isPlaying()){var k=map(t,0,i,0,myWidth-10);document.getElementById("timenow").setAttribute("x2",k)}0!==t&&(document.getElementById("playBorder").style.visibility="hidden")}if(t>.1&&.3>t||t>39.5&&39.7>t||t>55.2&&55.4>t||t>94.5&&94.7>t||t>110&&110.2>t||t>157.5&&157.7>t||t>189.2&&189.4>t||t>204.8&&205>t||t>236.4&&236.6>t||t>269&&269.2>t||t>283.4&&283.6>t){var B=document.getElementById("defaultCanvas"),E=B.toDataURL("image/jpeg",1);$("#side2").attr("src",E),$("#side").attr("src",E)}}function detectBeat(e){e>beatCutoff&&e>beatThreshold?(onBeat(),beatCutoff=1.1*e,framesSinceLastbeat=0):beatHoldFrames>=framesSinceLastbeat?framesSinceLastbeat++:(beatCutoff*=beatDecayRate,beatCutoff=Math.max(beatCutoff,beatThreshold))}function onBeat(){backgroundColor=color(random(155),random(80),random(155,255),random(70,100)),document.getElementById("container").style.background=backgroundColor.colorString,randomOnBeat++}function keyPressed(){if(" "==key)soundFile.isPlaying()?(soundFile.pause(),backgroundColor=color(0,0,0,80),document.getElementById("play").style.visibility="visible",document.getElementById("pause").style.visibility="hidden",document.getElementById("timenow").setAttribute("class","no_blink"),document.getElementById("playBorder").style.visibility="hidden"):(soundFile.play(),document.getElementById("play").style.visibility="hidden",document.getElementById("pause").style.visibility="visible",document.getElementById("timenow").setAttribute("class","blink_me"),$("#snapCont").hide("fast"),document.getElementById("playBorder").style.visibility="hidden");else if("5"==key){var e=document.getElementById("defaultCanvas"),t=e.toDataURL("image/jpeg",1);$("#side").attr("src",t)}else if("6"==key){var e=document.getElementById("defaultCanvas"),t=e.toDataURL("image/jpeg",1);$("#side2").attr("src",t)}}var postURL,myWidth=400,myHeight=300;$(document).ready(function(){$("#instruction").hide(),$("#snapCont").hide(),$("#howClick").click(function(){$("#instruction").slideToggle("fast")}),$("#closeClick").click(function(){$("#instruction").slideToggle("fast")}),$("#closeSnap").click(function(){$("#snapCont").hide("fast")}),document.getElementById("playBorder").style.visibility="visible",$("#snapClick").click(function(e){e.preventDefault();var t=document.getElementById("defaultCanvas");postURL=t.toDataURL("image/png"),submitform(),soundFile.pause(),document.getElementById("play").style.visibility="visible",document.getElementById("pause").style.visibility="hidden",document.getElementById("timenow").setAttribute("class","no_blink"),document.getElementById("playBorder").style.visibility="hidden"}),$("#clickPlay").click(function(e){e.preventDefault(),soundFile.play(),document.getElementById("play").style.visibility="hidden",document.getElementById("pause").style.visibility="visible",document.getElementById("timenow").setAttribute("class","blink_me"),$("#snapCont").hide("fast")}),$("#clickPause").click(function(e){e.preventDefault(),soundFile.pause(),backgroundColor=color(0,0,0,80),document.getElementById("play").style.visibility="visible",document.getElementById("pause").style.visibility="hidden",document.getElementById("timenow").setAttribute("class","no_blink"),document.getElementById("playBorder").style.visibility="hidden"})});var ctracker,soundFile,amplitude,backgroundColor=0,level,beatHoldFrames=20,beatThreshold=.11,beatCutoff=0,beatDecayRate=.95,framesSinceLastbeat=0,videoInput,canvas2,randomOnBeat=1,overlayimg,filter,filterFreq,filterRes;